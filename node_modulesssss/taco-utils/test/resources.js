// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for details.
/// <reference path="../../typings/node.d.ts"/>
/// <reference path="../../typings/should.d.ts"/>
/// <reference path="../../typings/mocha.d.ts"/>
"use strict";
var path = require("path");
var should = require("should");
var tacoUtility = require("../tacoUtils");
var resources = null;
describe("resources", function () {
    before(function () {
        resources = new tacoUtility.ResourceManager(path.join(__dirname, "resources"), "en");
    });
    it("should use the default language by default", function () {
        var expectedResources = require(path.join(__dirname, "/resources/en/resources.json"));
        var actual = resources.getString("SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should correctly return strings for a primary language", function () {
        var expectedResources = require(path.join(__dirname, "/resources/en/resources.json"));
        var actual = resources.getStringForLanguage("en", "SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should correctly return strings for a non-english primary language", function () {
        var expectedResources = require(path.join(__dirname, "/resources/it/resources.json"));
        var actual = resources.getStringForLanguage("it", "SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should correctly substitute arguments in resource strings", function () {
        var expectedResources = require(path.join(__dirname, "/resources/en/resources.json"));
        var actual = resources.getStringForLanguage("en", "MessageWithArgs", "Billy", "Fish");
        var expected = expectedResources["MessageWithArgs"];
        var actualBackToExpected = actual.replace("Billy", "{0}").replace("Fish", "{1}");
        actualBackToExpected.should.equal(expected);
        var actualWithArrayArgs = resources.getStringForLanguage("en", "MessageWithArgs", ["Billy", "Fish"]);
        actualWithArrayArgs.should.equal(actual);
    });
    it("should find the most specific region for a language", function () {
        var expectedResources = require(path.join(__dirname, "/resources/it-ch/resources.json"));
        var actual = resources.getStringForLanguage("it-ch", "SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should fall back to more general languages if a more specific one is not available", function () {
        var expectedResources = require(path.join(__dirname, "/resources/it/resources.json"));
        var actual = resources.getStringForLanguage("it-DE", "SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should fall back to english as a default if the language is unknown", function () {
        var expectedResources = require(path.join(__dirname, "/resources/en/resources.json"));
        var actual = resources.getStringForLanguage("hy-Latn-IT-arevela", "SimpleMessage");
        var expected = expectedResources["SimpleMessage"];
        actual.should.equal(expected);
    });
    it("should return undefined for bad resource identifiers", function () {
        var actual = resources.getStringForLanguage("en", "NoResourceDefinedForThis");
        should(actual).be.equal(undefined);
    });
    it("should handle unicode in resource strings", function () {
        var expectedResources = require(path.join(__dirname, "/resources/gb18030/resources.json"));
        var actual = resources.getStringForLanguage("gb18030", "UnicodeMessage");
        var expected = expectedResources["UnicodeMessage"];
        actual.should.equal(expected);
    });
    it("should replace all placeholders correctly", function () {
        var actual = resources.getStringForLanguage("en", "MessageWithRepeatedArgs", "X");
        actual.indexOf("{0}").should.be.equal(-1);
        var expectedResources = require(path.join(__dirname, "/resources/en/resources.json"));
        var expected = expectedResources["MessageWithRepeatedArgs"];
        expected.replace(/\{0\}/g, "X").should.equal(actual);
    });
});

//# sourceMappingURL=resources.js.map
